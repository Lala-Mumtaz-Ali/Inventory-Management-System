-- MySQL dump 10.13  Distrib 8.0.40, for Win64 (x86_64)
--
-- Host: 127.0.0.1    Database: mumtaz
-- ------------------------------------------------------
-- Server version	8.0.40

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `product_lot`
--

DROP TABLE IF EXISTS `product_lot`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `product_lot` (
  `Id` int NOT NULL AUTO_INCREMENT,
  `Manufacturing_Date` date DEFAULT NULL,
  `WareHouse_Id` int NOT NULL,
  `Product_id` int NOT NULL,
  `Quantity` int NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Product_Lot_Product_Product_id` (`Product_id`),
  KEY `FK_Product_Lot_WareHouse_WareHouse_Id` (`WareHouse_Id`),
  CONSTRAINT `FK_Product_Lot_Product_Product_id` FOREIGN KEY (`Product_id`) REFERENCES `product` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Product_Lot_WareHouse_WareHouse_Id` FOREIGN KEY (`WareHouse_Id`) REFERENCES `warehouse` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=350 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `product_lot`
--

LOCK TABLES `product_lot` WRITE;
/*!40000 ALTER TABLE `product_lot` DISABLE KEYS */;
INSERT INTO `product_lot` VALUES (1,'2024-01-08',1001,1,30),(2,'2024-06-09',1001,1,23),(4,'2024-10-18',1002,1,12),(5,'2024-01-02',1003,1,23),(6,'2024-09-09',1003,1,15),(7,'2023-12-07',1004,1,26),(8,'2024-04-29',1004,1,19),(9,'2024-08-13',1001,2,10),(10,'2024-08-16',1003,3,23),(11,'2024-02-12',1001,4,14),(12,'2024-05-25',1001,5,27),(13,'2024-05-04',1001,6,35),(14,'2024-09-14',1001,7,21),(15,'2024-03-03',1001,8,36),(16,'2024-09-07',1001,9,12),(17,'2024-04-29',1001,10,36),(18,'2024-11-04',1002,2,16),(19,'2023-12-13',1002,3,12),(20,'2024-03-23',1002,4,13),(21,'2024-07-24',1002,5,12),(22,'2024-07-03',1002,6,25),(23,'2024-04-25',1002,7,27),(24,'2024-04-22',1002,8,18),(25,'2024-10-27',1002,9,15),(26,'2024-09-02',1002,10,37),(27,'2024-03-04',1003,2,25),(28,'2024-02-03',1003,3,16),(29,'2023-12-19',1003,4,24),(30,'2024-05-02',1003,5,18),(31,'2024-06-24',1003,6,10),(32,'2023-12-05',1003,7,11),(33,'2024-02-12',1003,8,33),(34,'2024-09-02',1003,9,32),(35,'2024-07-17',1003,10,10),(36,'2024-02-10',1004,2,34),(37,'2024-01-11',1004,3,30),(38,'2024-05-09',1004,4,23),(39,'2024-04-09',1004,5,24),(40,'2024-10-21',1004,6,34),(41,'2024-08-31',1004,7,13),(42,'2024-03-31',1004,8,37),(43,'2024-07-10',1004,9,30),(44,'2024-07-21',1004,10,37),(173,'2024-11-19',1001,13,17),(174,'2024-02-06',1001,13,21),(175,'2024-09-22',1002,13,38),(176,'2024-09-19',1002,13,14),(177,'2023-12-02',1003,13,25),(178,'2024-10-23',1003,13,22),(179,'2023-12-21',1004,13,17),(180,'2023-12-18',1004,13,39),(181,'2024-05-17',1001,15,37),(182,'2024-04-11',1001,15,11),(183,'2024-09-21',1002,15,10),(184,'2024-02-04',1002,15,37),(185,'2024-02-06',1003,15,23),(186,'2024-11-07',1003,15,31),(187,'2024-02-16',1004,15,15),(188,'2024-07-24',1004,15,20),(189,'2024-05-12',1001,17,32),(190,'2024-08-27',1001,17,27),(191,'2024-01-01',1002,17,26),(192,'2023-12-14',1002,17,39),(193,'2024-11-16',1003,17,40),(194,'2024-11-27',1003,17,16),(195,'2024-03-08',1004,17,20),(196,'2024-03-01',1004,17,28),(198,'2024-09-20',1001,19,16),(199,'2023-12-24',1002,19,19),(200,'2024-11-23',1002,19,33),(201,'2024-01-29',1003,19,33),(202,'2024-03-26',1003,19,35),(203,'2024-07-17',1004,19,37),(204,'2024-01-21',1004,19,15),(205,'2023-12-22',1001,10,31),(206,'2024-10-27',1002,10,27),(207,'2024-09-10',1003,10,31),(208,'2024-07-30',1004,10,40),(209,'2024-07-31',1001,12,30),(210,'2024-08-30',1002,12,30),(211,'2024-03-11',1003,12,19),(212,'2024-06-24',1004,12,32),(213,'2024-03-22',1001,14,40),(214,'2024-09-28',1002,14,23),(215,'2023-12-06',1003,14,25),(216,'2024-10-09',1004,14,22),(217,'2024-02-25',1001,16,23),(218,'2024-09-23',1002,16,25),(219,'2024-05-05',1003,16,23),(220,'2024-10-06',1004,16,27),(221,'2024-04-16',1001,18,10),(222,'2024-06-05',1002,18,12),(223,'2024-05-08',1003,18,16),(224,'2024-08-14',1004,18,15),(225,'2024-06-17',1001,20,36),(226,'2024-01-04',1002,20,30),(227,'2024-11-05',1003,20,27),(228,'2024-10-21',1004,20,30),(229,'2024-07-07',1001,21,26),(230,'2024-05-16',1001,21,20),(231,'2024-04-14',1002,21,5),(232,'2024-11-15',1002,21,15),(233,'2024-11-09',1003,21,29),(234,'2024-03-27',1003,21,21),(235,'2024-08-04',1004,21,18),(236,'2023-12-18',1004,21,34),(237,'2024-10-02',1001,23,22),(238,'2024-06-26',1001,23,27),(239,'2024-04-04',1002,23,16),(240,'2024-05-13',1002,23,13),(241,'2024-05-29',1003,23,23),(242,'2024-04-18',1003,23,16),(243,'2024-10-07',1004,23,22),(244,'2024-10-08',1004,23,25),(245,'2024-07-15',1001,25,14),(246,'2024-01-28',1001,25,22),(247,'2024-06-07',1002,25,40),(248,'2024-05-08',1002,25,22),(249,'2024-08-12',1003,25,28),(250,'2024-04-24',1003,25,31),(251,'2024-04-02',1004,25,37),(252,'2024-10-12',1004,25,29),(253,'2024-06-03',1001,27,33),(254,'2024-10-13',1001,27,13),(255,'2023-12-12',1002,27,18),(256,'2024-09-17',1002,27,10),(257,'2024-11-15',1003,27,38),(258,'2024-01-06',1003,27,22),(259,'2024-03-12',1004,27,18),(260,'2024-06-04',1004,27,32),(261,'2024-02-27',1001,29,17),(262,'2023-12-16',1001,29,11),(263,'2024-08-07',1002,29,29),(264,'2024-08-18',1002,29,29),(265,'2024-05-19',1003,29,24),(266,'2024-05-19',1003,29,16),(267,'2024-08-18',1004,29,40),(268,'2024-05-25',1004,29,24),(269,'2024-09-07',1001,20,14),(270,'2024-04-15',1002,20,30),(271,'2024-02-15',1003,20,13),(272,'2024-08-03',1004,20,26),(273,'2023-12-02',1001,22,40),(274,'2023-12-20',1002,22,35),(275,'2023-12-12',1003,22,33),(276,'2024-01-27',1004,22,26),(277,'2024-08-27',1001,24,27),(278,'2024-08-17',1002,24,28),(279,'2024-10-31',1003,24,28),(280,'2024-01-03',1004,24,29),(281,'2024-06-17',1001,26,29),(282,'2024-07-01',1002,26,20),(283,'2024-03-08',1003,26,40),(284,'2024-10-27',1004,26,30),(285,'2024-10-23',1001,28,24),(286,'2024-10-28',1002,28,12),(287,'2024-03-21',1003,28,15),(288,'2024-07-16',1004,28,37),(289,'2024-02-12',1001,30,15),(290,'2024-02-27',1002,30,23),(291,'2024-10-03',1003,30,24),(292,'2024-10-22',1004,30,19),(293,'2024-05-22',1001,31,27),(294,'2023-12-01',1001,31,38),(295,'2024-09-28',1002,31,17),(296,'2024-09-16',1002,31,14),(297,'2024-08-04',1003,31,28),(298,'2024-09-13',1003,31,35),(299,'2024-10-31',1004,31,26),(300,'2024-05-07',1004,31,33),(301,'2023-12-07',1001,33,26),(302,'2024-05-21',1001,33,19),(303,'2024-10-08',1002,33,32),(304,'2023-12-26',1002,33,24),(305,'2024-08-06',1003,33,16),(306,'2024-04-18',1003,33,38),(307,'2024-02-02',1004,33,20),(308,'2024-11-01',1004,33,13),(309,'2024-11-27',1001,35,11),(310,'2024-07-23',1001,35,36),(311,'2024-04-07',1002,35,14),(312,'2024-11-10',1002,35,34),(313,'2024-10-16',1003,35,36),(314,'2024-02-06',1003,35,11),(315,'2024-08-03',1004,35,39),(316,'2024-02-10',1004,35,33),(317,'2024-08-21',1001,32,32),(318,'2023-12-12',1002,32,14),(319,'2024-01-27',1003,32,20),(320,'2024-08-26',1004,32,14),(321,'2024-08-03',1001,34,35),(322,'2024-02-27',1002,34,14),(323,'2024-06-17',1003,34,20),(324,'2024-03-10',1004,34,16),(325,'2024-04-04',1001,36,39),(326,'2024-01-10',1002,36,21),(327,'2023-12-22',1003,36,19),(328,'2024-01-25',1004,36,32),(329,'2024-11-30',1001,3,150),(330,'2024-11-30',1004,37,260),(331,'2024-11-30',1003,37,250),(332,'2024-11-30',1002,37,200),(333,'2024-11-30',1001,37,150),(334,'2024-11-30',1004,38,260),(335,'2024-11-30',1003,38,250),(336,'2024-11-30',1002,38,200),(337,'2024-11-30',1001,38,150),(338,'2024-11-30',1004,39,260),(339,'2024-11-30',1003,39,250),(340,'2024-11-30',1002,39,200),(341,'2024-11-30',1001,39,150),(342,'2024-11-30',1004,40,260),(343,'2024-11-30',1003,40,250),(344,'2024-11-30',1002,40,200),(345,'2024-11-30',1001,40,150),(346,'2024-11-30',1004,41,260),(347,'2024-11-30',1003,41,250),(348,'2024-11-30',1002,41,200),(349,'2024-11-30',1001,41,150);
/*!40000 ALTER TABLE `product_lot` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `AfterProductLotUpdate` AFTER UPDATE ON `product_lot` FOR EACH ROW BEGIN
    DECLARE last_movement_id INT;

    IF OLD.WareHouse_Id != NEW.WareHouse_Id THEN
        SELECT lm.Id 
        INTO last_movement_id
        FROM LotMovements lm
        WHERE lm.Lot_Id = NEW.Id
        ORDER BY lm.Transaction_date DESC
        LIMIT 1;

        INSERT INTO LotMovements (Source, Destination, Lot_Id, Transaction_date, Related_Movement)
        VALUES (OLD.WareHouse_Id, NEW.WareHouse_Id, NEW.Id, NOW(), last_movement_id);
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2024-11-30  4:13:56
